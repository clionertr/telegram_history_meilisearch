# åç«¯æ ¸å¿ƒåŠŸèƒ½å¼€å‘ - å·¥ä½œæ—¥å¿— (å·²é‡ç½®)

*(æ­¤æ–‡ä»¶ç”¨äºè®°å½•å½“å‰æ­£åœ¨æ‰§è¡Œçš„å­ä»»åŠ¡çš„è¯¦ç»†è¿‡ç¨‹ã€‚ä¸‹ä¸€ä¸ªä»»åŠ¡çš„æ—¥å¿—å°†ä»è¿™é‡Œå¼€å§‹ã€‚)*

## ä»»åŠ¡8: `search_bot/message_formatters.py` å¼€å‘

**æ—¥æœŸ**: 2025å¹´5æœˆ20æ—¥

### 1. éœ€æ±‚åˆ†æ

æ ¹æ® `FOLLOWME.md` å’Œ `PLAN.md` ä¸­çš„æè¿°ï¼Œ`message_formatters.py` éœ€è¦å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š

- å®ç° `format_search_results(results, current_page, total_pages)` å‡½æ•°
- å°† Meilisearch è¿”å›çš„åŸå§‹æœç´¢ç»“æœæ ¼å¼åŒ–ä¸ºç”¨æˆ·å‹å¥½çš„æ–‡æœ¬
- æ¯æ¡ç»“æœåº”åŒ…å«ï¼šæ¶ˆæ¯æ‘˜è¦ã€å‘é€è€…ã€æ—¶é—´å’ŒåŸå§‹æ¶ˆæ¯é“¾æ¥
- æ”¯æŒåˆ†é¡µï¼Œç”Ÿæˆåˆ†é¡µæŒ‰é’®

### 2. èµ„æ–™æ”¶é›†

æˆ‘é¦–å…ˆæ£€æŸ¥äº†ä»¥ä¸‹ç›¸å…³æ–‡ä»¶ï¼Œäº†è§£æ•°æ®ç»“æ„å’Œå·²æœ‰åŠŸèƒ½ï¼š

1. **`core/models.py`**: äº†è§£ `MeiliMessageDoc` çš„ç»“æ„ï¼ŒåŒ…å«å­—æ®µå¦‚ `id`ã€`message_id`ã€`chat_id`ã€`chat_title`ã€`chat_type`ã€`sender_id`ã€`sender_name`ã€`text`ã€`date` å’Œ `message_link`ã€‚

2. **`user_bot/utils.py`**: äº†è§£ `generate_message_link` å‡½æ•°ï¼Œå®ƒç”¨äºç”ŸæˆæŒ‡å‘ Telegram åŸå§‹æ¶ˆæ¯çš„é“¾æ¥ã€‚

3. **`core/meilisearch_service.py`**: äº†è§£ `search` æ–¹æ³•çš„å‚æ•°å’Œè¿”å›ç»“æœçš„ç»“æ„ã€‚

4. **`FOLLOWME.md`**: æŸ¥çœ‹ API ç¤ºä¾‹ä¸­çš„ Response Bodyï¼Œäº†è§£ Meilisearch è¿”å›ç»“æœçš„æ ¼å¼ã€‚

### 3. è®¾è®¡æ€è·¯

1. **æ ¼å¼åŒ–æ¶ˆæ¯å†…å®¹**ï¼š
   - å¯¹äºæ¯æ¡æœç´¢ç»“æœï¼Œæå–é‡è¦ä¿¡æ¯ï¼ˆå‘é€è€…ã€èŠå¤©æ ‡é¢˜ã€æ—¶é—´ã€æ–‡æœ¬å†…å®¹ï¼‰
   - ä¼˜å…ˆä½¿ç”¨ Meilisearch è¿”å›çš„é«˜äº®ç‰‡æ®µï¼ˆå¦‚æœæœ‰ï¼‰ï¼Œä½¿ç”¨æˆ·æ›´å®¹æ˜“æ‰¾åˆ°åŒ¹é…çš„å†…å®¹
   - é™åˆ¶æ–‡æœ¬é•¿åº¦ï¼Œé¿å…æ¶ˆæ¯è¿‡é•¿
   - æ·»åŠ æŒ‡å‘åŸå§‹æ¶ˆæ¯çš„é“¾æ¥

2. **åˆ†é¡µè®¾è®¡**ï¼š
   - ä½¿ç”¨ Telethon çš„ `Button.inline` åˆ›å»ºå†…è”æŒ‰é’®
   - æä¾›å¯¼èˆªæŒ‰é’®ï¼šé¦–é¡µã€ä¸Šä¸€é¡µã€å½“å‰é¡µ/æ€»é¡µæ•°ã€ä¸‹ä¸€é¡µã€æœ«é¡µ
   - åœ¨æŒ‰é’®çš„å›è°ƒæ•°æ®ä¸­åŒ…å«é¡µç å’ŒæŸ¥è¯¢å‚æ•°ï¼Œæ–¹ä¾¿ `callback_query_handlers.py` å¤„ç†åˆ†é¡µè¯·æ±‚

3. **é”™è¯¯å¤„ç†**ï¼š
   - æ·»åŠ  `format_error_message` å‡½æ•°å¤„ç†æœç´¢å¼‚å¸¸
   - æ·»åŠ  `format_help_message` å‡½æ•°ç”Ÿæˆå¸®åŠ©æ¶ˆæ¯

### 4. å®ç°ç»†èŠ‚

1. **`format_search_results` å‡½æ•°**:
   - è¿”å›ç±»å‹ä¸º `Tuple[str, Optional[List[List[Button]]]]`ï¼ŒåŒ…å«æ ¼å¼åŒ–çš„æ¶ˆæ¯æ–‡æœ¬å’Œåˆ†é¡µæŒ‰é’®
   - ä¼˜å…ˆä½¿ç”¨ Meilisearch çš„ `_formatted` ä¸­çš„é«˜äº®ç‰‡æ®µ
   - æ—¶é—´æˆ³ï¼ˆUnix timestampï¼‰è½¬æ¢ä¸ºäººç±»å¯è¯»çš„æ—¥æœŸæ—¶é—´æ ¼å¼
   - æ„å»ºç®€æ´æ˜äº†çš„æ¶ˆæ¯æ ¼å¼ï¼ŒåŒ…å«åºå·ã€å‘é€è€…ã€èŠå¤©æ ‡é¢˜ã€æ—¶é—´ã€æ–‡æœ¬æ‘˜è¦å’ŒåŸå§‹æ¶ˆæ¯é“¾æ¥
   - å¯¹äºç©ºç»“æœï¼Œè¿”å›å‹å¥½çš„æç¤ºæ¶ˆæ¯

2. **åˆ†é¡µæŒ‰é’®å¤„ç†**:
   - æ ¹æ®å½“å‰é¡µç å’Œæ€»é¡µæ•°åŠ¨æ€ç”Ÿæˆä¸åŒçš„æŒ‰é’®ç»„åˆ
   - æŒ‰é’®å›è°ƒæ•°æ®æ ¼å¼ï¼š`page_{é¡µç }_{æŸ¥è¯¢å‚æ•°}`ï¼Œç”¨äºå›è°ƒæŸ¥è¯¢å¤„ç†
   - é™åˆ¶æŸ¥è¯¢å‚æ•°é•¿åº¦ï¼Œé˜²æ­¢å›è°ƒæ•°æ®è¿‡å¤§
   - å¦‚æœæŒ‰é’®è¿‡å¤šï¼Œè€ƒè™‘æ‹†åˆ†ä¸ºä¸¤è¡Œæ˜¾ç¤º

3. **é”™è¯¯å’Œå¸®åŠ©æ¶ˆæ¯**:
   - æ ¼å¼åŒ–é”™è¯¯æ¶ˆæ¯ï¼Œæä¾›ç”¨æˆ·å‹å¥½çš„æç¤º
   - æä¾›è¯¦ç»†çš„æœç´¢å¸®åŠ©ï¼ŒåŒ…æ‹¬åŸºæœ¬æœç´¢å’Œé«˜çº§æœç´¢è¯­æ³•è¯´æ˜

### 5. ä¼˜åŒ–è€ƒè™‘

1. **å¯æ‰©å±•æ€§**:
   - å‡½æ•°è®¾è®¡è€ƒè™‘äº†æœªæ¥å¯èƒ½çš„æ‰©å±•ï¼Œå¦‚æ·»åŠ æ›´å¤šè¿‡æ»¤æ¡ä»¶
   - ä»£ç ç»“æ„æ¸…æ™°ï¼Œä¾¿äºç»´æŠ¤å’Œä¿®æ”¹

2. **ç”¨æˆ·ä½“éªŒ**:
   - ä½¿ç”¨ emoji å¢å¼ºå¯è¯»æ€§å’Œè§†è§‰å¸å¼•åŠ›
   - æä¾›æ¸…æ™°çš„å¯¼èˆªå’Œæç¤ºä¿¡æ¯
   - é“¾æ¥ç›´æ¥å¯ç‚¹å‡»ï¼Œæ–¹ä¾¿ç”¨æˆ·æŸ¥çœ‹åŸå§‹æ¶ˆæ¯

### 6. æµ‹è¯•è®¡åˆ’

ç”±äº Search Bot çš„å…¶ä»–éƒ¨åˆ†ï¼ˆå¦‚ `bot.py`ã€`command_handlers.py` å’Œ `callback_query_handlers.py`ï¼‰å°šæœªå®ç°ï¼Œæš‚æ—¶æ— æ³•è¿›è¡Œå®Œæ•´çš„åŠŸèƒ½æµ‹è¯•ã€‚è®¡åˆ’åœ¨è¿™äº›æ–‡ä»¶å®ç°åï¼Œè¿›è¡Œä»¥ä¸‹æµ‹è¯•ï¼š

1. **å•å…ƒæµ‹è¯•**:
   - æµ‹è¯• `format_search_results` å‡½æ•°å¯¹å„ç§æœç´¢ç»“æœçš„æ ¼å¼åŒ–
   - æµ‹è¯•è¾¹ç•Œæƒ…å†µï¼ˆå¦‚ç©ºç»“æœã€å•é¡µç»“æœã€å¤šé¡µç»“æœï¼‰
   - æµ‹è¯•å„ç§é”™è¯¯æƒ…å†µçš„å¤„ç†

2. **é›†æˆæµ‹è¯•**:
   - ä¸ `MeiliSearchService.search()` ç»“åˆæµ‹è¯•
   - ä¸ Telethon æ¶ˆæ¯å‘é€å’ŒæŒ‰é’®å›è°ƒå¤„ç†ç»“åˆæµ‹è¯•

### 7. é‡åˆ°çš„æŒ‘æˆ˜å’Œè§£å†³æ–¹æ¡ˆ

1. **é«˜äº®ç‰‡æ®µå¤„ç†**ï¼š
   - æŒ‘æˆ˜ï¼šéœ€è¦ç¡®å®š Meilisearch æ˜¯å¦è¿”å›äº†é«˜äº®ç‰‡æ®µï¼Œä»¥åŠå¦‚ä½•å¤„ç†
   - è§£å†³æ–¹æ¡ˆï¼šé€šè¿‡æ£€æŸ¥ `_formatted` å­—æ®µæ˜¯å¦å­˜åœ¨å¹¶åŒ…å« `text`ï¼Œå†³å®šä½¿ç”¨é«˜äº®ç‰‡æ®µè¿˜æ˜¯åŸå§‹æ–‡æœ¬

2. **æŒ‰é’®æ•°æ®å­˜å‚¨**ï¼š
   - æŒ‘æˆ˜ï¼šéœ€è¦åœ¨æŒ‰é’®å›è°ƒæ•°æ®ä¸­åŒ…å«è¶³å¤Ÿä¿¡æ¯ï¼ŒåŒæ—¶ä¿æŒæ•°æ®é‡åˆç†
   - è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ç®€æ´çš„æ ¼å¼ `page_{é¡µç }_{æŸ¥è¯¢å‚æ•°}`ï¼Œå¹¶é™åˆ¶æŸ¥è¯¢å‚æ•°é•¿åº¦

### 8. æ€»ç»“

`search_bot/message_formatters.py` æ¨¡å—å·²å®ç°ï¼Œæä¾›äº†å°† Meilisearch æœç´¢ç»“æœæ ¼å¼åŒ–ä¸ºç”¨æˆ·å‹å¥½çš„ Telegram æ¶ˆæ¯çš„åŠŸèƒ½ã€‚ä»£ç å·²æ·»åŠ è¯¦ç»†çš„æ–‡æ¡£å’Œç±»å‹æç¤ºï¼Œéµå¾ª PEP 8 è§„èŒƒï¼ŒåŒæ—¶è€ƒè™‘äº†å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚

ä¸‹ä¸€æ­¥æ˜¯å®ç° `callback_query_handlers.py` ä»¥å¤„ç†åˆ†é¡µæŒ‰é’®çš„å›è°ƒï¼Œä»¥åŠ `command_handlers.py` ä»¥å¤„ç†ç”¨æˆ·å‘½ä»¤å¹¶è°ƒç”¨æœç´¢åŠŸèƒ½ã€‚

### 9. å•å…ƒæµ‹è¯•

ä¸ºäº†éªŒè¯ `message_formatters.py` çš„åŠŸèƒ½ï¼Œæˆ‘ç¼–å†™äº†å•å…ƒæµ‹è¯•æ–‡ä»¶ `tests/unit/test_message_formatters.py`ï¼Œæµ‹è¯•å†…å®¹åŒ…æ‹¬ï¼š

1. **ç©ºç»“æœæµ‹è¯•**ï¼šéªŒè¯åœ¨æ²¡æœ‰æœç´¢ç»“æœæ—¶è¿”å›é€‚å½“çš„æ¶ˆæ¯å’Œæ— åˆ†é¡µæŒ‰é’®
2. **å•æ¡ç»“æœæµ‹è¯•**ï¼šéªŒè¯å•æ¡ç»“æœçš„æ ¼å¼åŒ–æ˜¯å¦æ­£ç¡®
3. **é«˜äº®ç‰‡æ®µæµ‹è¯•**ï¼šéªŒè¯æ­£ç¡®å¤„ç† Meilisearch è¿”å›çš„é«˜äº®ç‰‡æ®µ
4. **åˆ†é¡µæŒ‰é’®æµ‹è¯•**ï¼šéªŒè¯åœ¨ä¸åŒé¡µç æƒ…å†µä¸‹ï¼ˆé¦–é¡µã€ä¸­é—´é¡µã€æœ«é¡µï¼‰ç”Ÿæˆçš„åˆ†é¡µæŒ‰é’®æ˜¯å¦æ­£ç¡®
5. **é”™è¯¯æ¶ˆæ¯æµ‹è¯•**ï¼šéªŒè¯é”™è¯¯æ¶ˆæ¯çš„æ ¼å¼åŒ–
6. **å¸®åŠ©æ¶ˆæ¯æµ‹è¯•**ï¼šéªŒè¯å¸®åŠ©æ¶ˆæ¯åŒ…å«æ‰€æœ‰å¿…è¦çš„ä¿¡æ¯

æµ‹è¯•ä½¿ç”¨äº† Python çš„ `unittest` æ¡†æ¶å’Œ `unittest.mock` æ¥æ¨¡æ‹Ÿ Telethon çš„ `Button` ç±»ï¼Œè¿™æ ·å¯ä»¥åœ¨ä¸ä¾èµ– Telethon åº“çš„æƒ…å†µä¸‹æµ‹è¯•æŒ‰é’®ç”Ÿæˆé€»è¾‘ã€‚

### ä»£ç å®ç°

```python
"""
æ¶ˆæ¯æ ¼å¼åŒ–æ¨¡å—

æ­¤æ¨¡å—è´Ÿè´£å°†ä» Meilisearch è¿”å›çš„åŸå§‹æœç´¢ç»“æœæ•°æ®æ ¼å¼åŒ–ä¸ºç”¨æˆ·å‹å¥½çš„æ–‡æœ¬ï¼Œ
å‡†å¤‡åœ¨ Telegram Bot ä¸­å±•ç¤ºã€‚è¿˜è´Ÿè´£ç”Ÿæˆåˆ†é¡µæŒ‰é’®ç­‰äº¤äº’å…ƒç´ ã€‚
"""

import logging
from typing import Dict, Any, List, Optional, Tuple
from datetime import datetime
from telethon import Button

from user_bot.utils import generate_message_link

# é…ç½®æ—¥å¿—è®°å½•å™¨
logger = logging.getLogger(__name__)


def format_search_results(
    results: Dict[str, Any], 
    current_page: int, 
    total_pages: int
) -> Tuple[str, Optional[List[List[Button]]]]:
    """
    æ ¼å¼åŒ– Meilisearch æœç´¢ç»“æœä¸ºç”¨æˆ·å‹å¥½çš„æ–‡æœ¬
    
    å°† Meilisearch è¿”å›çš„åŸå§‹æœç´¢ç»“æœæ ¼å¼åŒ–ä¸ºç”¨æˆ·å‹å¥½çš„æ–‡æœ¬ï¼Œ
    åŒ…æ‹¬æ¶ˆæ¯æ‘˜è¦ã€å‘é€è€…ã€æ—¶é—´å’ŒåŸå§‹æ¶ˆæ¯é“¾æ¥ã€‚
    åŒæ—¶ç”Ÿæˆåˆ†é¡µæŒ‰é’®ã€‚
    
    Args:
        results: Meilisearch è¿”å›çš„æœç´¢ç»“æœå­—å…¸
        current_page: å½“å‰é¡µç ï¼Œä» 1 å¼€å§‹
        total_pages: æ€»é¡µæ•°
        
    Returns:
        Tuple[str, Optional[List[List[Button]]]]: 
            - æ ¼å¼åŒ–åçš„æ¶ˆæ¯æ–‡æœ¬
            - åˆ†é¡µæŒ‰é’®åˆ—è¡¨ï¼ˆå¦‚æœæœ‰åˆ†é¡µï¼‰æˆ– Noneï¼ˆå¦‚æœæ²¡æœ‰åˆ†é¡µï¼‰
    """
    if not results or 'hits' not in results or not results['hits']:
        return "ğŸ˜• æœªæ‰¾åˆ°åŒ¹é…çš„æ¶ˆæ¯ã€‚è¯·å°è¯•å…¶ä»–å…³é”®è¯æˆ–æ£€æŸ¥æœç´¢è¯­æ³•ã€‚", None
    
    # æå–åŸºæœ¬æœç´¢ä¿¡æ¯
    query = results.get('query', '')
    total_hits = results.get('estimatedTotalHits', 0)
    processing_time = results.get('processingTimeMs', 0)
    
    # æ„å»ºæ¶ˆæ¯å¤´éƒ¨
    message_parts = [
        f"ğŸ” **æœç´¢ç»“æœ: \"{query}\"**\n",
        f"ğŸ“Š æ‰¾åˆ°çº¦ {total_hits} æ¡åŒ¹é…æ¶ˆæ¯ (ç”¨æ—¶ {processing_time}ms)\n",
        f"ğŸ“„ ç¬¬ {current_page}/{total_pages} é¡µ\n\n"
    ]
    
    # éå†ç»“æœï¼Œæ ¼å¼åŒ–æ¯æ¡æ¶ˆæ¯
    for index, hit in enumerate(results['hits'], 1):
        # è·å–æ¶ˆæ¯åŸºæœ¬ä¿¡æ¯
        chat_title = hit.get('chat_title', 'æœªçŸ¥èŠå¤©')
        sender_name = hit.get('sender_name', 'æœªçŸ¥å‘é€è€…')
        
        # å¤„ç†æ—¥æœŸæ—¶é—´ (Unix æ—¶é—´æˆ³è½¬æ¢ä¸ºå¯è¯»æ ¼å¼)
        timestamp = hit.get('date', 0)
        date_str = datetime.fromtimestamp(timestamp).strftime('%Y-%m-%d %H:%M:%S')
        
        # è·å–æ¶ˆæ¯é“¾æ¥
        message_link = hit.get('message_link', '')
        
        # è·å–æ¶ˆæ¯æ–‡æœ¬ï¼Œä¼˜å…ˆä½¿ç”¨ Meilisearch çš„é«˜äº®ç‰‡æ®µï¼ˆå¦‚æœæœ‰ï¼‰
        if '_formatted' in hit and 'text' in hit['_formatted']:
            # Meilisearch è¿”å›çš„é«˜äº®ç‰‡æ®µï¼Œå·²åŒ…å«é«˜äº®æ ‡è®°
            text_preview = hit['_formatted']['text']
        else:
            # å¦‚æœæ²¡æœ‰é«˜äº®ç‰‡æ®µï¼Œä½¿ç”¨åŸå§‹æ–‡æœ¬å¹¶æˆªå–åˆé€‚é•¿åº¦
            original_text = hit.get('text', '')
            text_preview = (original_text[:150] + '...') if len(original_text) > 150 else original_text
        
        # æ ¼å¼åŒ–å•æ¡æ¶ˆæ¯
        message_parts.append(
            f"{index}. **{sender_name}** åœ¨ **{chat_title}** ä¸­å‘è¡¨äº {date_str}\n"
            f"{text_preview}\n"
            f"[ğŸ‘‰ æŸ¥çœ‹åŸæ¶ˆæ¯]({message_link})\n\n"
        )
    
    # æ„å»ºåˆ†é¡µæŒ‰é’® (å¦‚æœéœ€è¦)
    buttons = None
    if total_pages > 1:
        # åˆ›å»ºä¸€ç»„æŒ‰é’®ï¼Œæˆ‘ä»¬é™åˆ¶ä¸º:
        # 1. é¦–é¡µæŒ‰é’® (å¦‚æœä¸åœ¨ç¬¬ä¸€é¡µ)
        # 2. ä¸Šä¸€é¡µæŒ‰é’® (å¦‚æœä¸åœ¨ç¬¬ä¸€é¡µ)
        # 3. å½“å‰é¡µç /æ€»é¡µæ•°
        # 4. ä¸‹ä¸€é¡µæŒ‰é’® (å¦‚æœä¸åœ¨æœ€åä¸€é¡µ)
        # 5. æœ«é¡µæŒ‰é’® (å¦‚æœä¸åœ¨æœ€åä¸€é¡µ)
        buttons_row = []
        
        # æ¯ä¸ªæŒ‰é’®å­˜å‚¨æ•°æ®æ ¼å¼ï¼špage_{é¡µç }_{æœç´¢æŸ¥è¯¢}
        query_param = query[:30]  # é™åˆ¶æŸ¥è¯¢å‚æ•°é•¿åº¦ï¼Œé˜²æ­¢æ•°æ®è¿‡å¤§
        
        # é¦–é¡µå’Œä¸Šä¸€é¡µæŒ‰é’® (å¦‚æœå½“å‰ä¸åœ¨ç¬¬ä¸€é¡µ)
        if current_page > 1:
            buttons_row.append(Button.inline("â® é¦–é¡µ", f"page_1_{query_param}"))
            buttons_row.append(Button.inline("â—€ï¸ ä¸Šä¸€é¡µ", f"page_{current_page - 1}_{query_param}"))
        
        # å½“å‰é¡µ/æ€»é¡µæ•°æŒ‰é’® (ä¸å¯ç‚¹å‡»)
        buttons_row.append(Button.inline(f"ğŸ“„ {current_page}/{total_pages}", f"noop"))
        
        # ä¸‹ä¸€é¡µå’Œæœ«é¡µæŒ‰é’® (å¦‚æœå½“å‰ä¸åœ¨æœ€åä¸€é¡µ)
        if current_page < total_pages:
            buttons_row.append(Button.inline("â–¶ï¸ ä¸‹ä¸€é¡µ", f"page_{current_page + 1}_{query_param}"))
            buttons_row.append(Button.inline("â­ æœ«é¡µ", f"page_{total_pages}_{query_param}"))
        
        buttons = [buttons_row]
        
        # å¦‚æœæŒ‰é’®è¶…è¿‡5ä¸ªï¼Œæ‹†åˆ†ä¸ºä¸¤è¡Œ
        if len(buttons_row) > 5:
            nav_buttons = buttons_row[:2] + buttons_row[3:]  # å¯¼èˆªæŒ‰é’®
            page_button = [buttons_row[2]]  # é¡µç æŒ‰é’®
            buttons = [nav_buttons, page_button]
    
    # åˆå¹¶æ‰€æœ‰æ¶ˆæ¯éƒ¨åˆ†
    formatted_message = ''.join(message_parts)
    
    logger.debug(f"å·²æ ¼å¼åŒ–æœç´¢ç»“æœï¼ŒåŒ…å« {len(results['hits'])} æ¡æ¶ˆæ¯ï¼Œå…± {total_pages} é¡µ")
    return formatted_message, buttons


def format_error_message(error_message: str) -> str:
    """
    æ ¼å¼åŒ–é”™è¯¯æ¶ˆæ¯
    
    å°†é”™è¯¯æ¶ˆæ¯æ ¼å¼åŒ–ä¸ºç”¨æˆ·å‹å¥½çš„æ–‡æœ¬
    
    Args:
        error_message: é”™è¯¯ä¿¡æ¯
        
    Returns:
        str: æ ¼å¼åŒ–åçš„é”™è¯¯æ¶ˆæ¯
    """
    return f"âš ï¸ **æœç´¢å‡ºé”™**\n\n{error_message}\n\nè¯·æ£€æŸ¥æ‚¨çš„æœç´¢è¯­æ³•æˆ–ç¨åå†è¯•ã€‚"


def format_help_message() -> str:
    """
    ç”Ÿæˆå¸®åŠ©æ¶ˆæ¯
    
    è¿”å›æœç´¢åŠŸèƒ½çš„å¸®åŠ©è¯´æ˜
    
    Returns:
        str: å¸®åŠ©è¯´æ˜æ–‡æœ¬
    """
    return (
        "ğŸ” **Telegram ä¸­æ–‡å†å²æ¶ˆæ¯æœç´¢**\n\n"
        "**åŸºæœ¬æœç´¢**:\n"
        "ç›´æ¥å‘é€å…³é”®è¯ï¼Œå¦‚: `/search å¦‚ä½•å­¦ä¹ Python`\n\n"
        "**é«˜çº§æœç´¢**:\n"
        "1. ç²¾ç¡®çŸ­è¯­: `\"å…³é”®çŸ­è¯­\"`ï¼Œå¦‚: `/search \"æœºå™¨å­¦ä¹ ç®—æ³•\"`\n"
        "2. ç±»å‹ç­›é€‰: `type:ç±»å‹`ï¼Œå¦‚: `/search å­¦ä¹  type:group`\n"
        "   æ”¯æŒçš„ç±»å‹: user(ç§èŠ), group(ç¾¤ç»„), channel(é¢‘é“)\n"
        "3. æ—¶é—´ç­›é€‰: `date:èµ·å§‹_ç»“æŸ`ï¼Œå¦‚: `/search ä¼šè®® date:2023-01-01_2023-12-31`\n"
        "   æ—¥æœŸæ ¼å¼: YYYY-MM-DD\n"
        "4. ç»„åˆä½¿ç”¨: `/search \"é¡¹ç›®è¿›åº¦\" type:group date:2023-01-01_2023-12-31`\n\n"
        "**æç¤º**:\n"
        "- é»˜è®¤æ˜¾ç¤ºæœ€ç›¸å…³çš„ç»“æœï¼ŒæŒ‰é¡µé¢åº•éƒ¨æŒ‰é’®ç¿»é¡µæŸ¥çœ‹æ›´å¤š\n"
        "- ç‚¹å‡»æ¶ˆæ¯ä¸‹æ–¹é“¾æ¥å¯è·³è½¬åˆ°åŸå§‹æ¶ˆæ¯\n"
    )